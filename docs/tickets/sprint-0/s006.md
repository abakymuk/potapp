S-00.6 — .editorconfig & Commit Hooks

Goal: simple Husky + lint-staged для автоформатирования staged файлов.
Scope:
• In: .editorconfig, husky pre-commit hook, lint-staged конфиг, скрипты в root.
• Out: доп. проверки (typecheck/lint в hook’ах) — отдельно при желании.

AC (Gherkin)
• Given у меня есть изменённые файлы и я их git add
When выполняю git commit -m "test"
Then pre-commit запускает форматирование только по staged файлам и коммит проходит без ошибок.

DoD
• Добавлен .editorconfig в корень
• Установлены husky и lint-staged
• Инициализирован .husky/pre-commit с вызовом pnpm exec lint-staged
• В package.json добавлена конфигурация lint-staged (только форматирование)
• git commit форматит staged файлы автоматически
• Короткая заметка /docs/notes/commit-hooks.md

⸻

Микротикеты (атомарные шаги)

S-00.6.a — Добавить .editorconfig

Создай файл в корне .editorconfig:

root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
indent_style = space
indent_size = 2
trim_trailing_whitespace = true

[*.md]
trim_trailing_whitespace = false

[*.{yml,yaml}]
indent_size = 2

S-00.6.b — Установить зависимости

pnpm add -D husky lint-staged

S-00.6.c — Инициализировать Husky (создать папку hooks)

Нужно выполнить один раз после pnpm i.

pnpm exec husky init

Это создаст .husky/pre-commit с дефолтным содержимым — заменим его.

S-00.6.d — Настроить pre-commit hook

Перезапиши .husky/pre-commit:

#!/usr/bin/env sh
. "$(dirname -- "$0")/\_/husky.sh"

# Форматируем только staged файлы

pnpm exec lint-staged

Скрипт должен быть исполняемым (husky выставляет права автоматически).

S-00.6.e — Конфиг lint-staged

Добавь в root package.json:

{
"scripts": {
"prepare": "husky"
},
"lint-staged": {
"\*.{ts,tsx,js,jsx,json,md,css,scss,yml,yaml}": [
"prettier -w"
]
}
}

Мы сознательно не запускаем ESLint в hook’е, чтобы не тормозить DX. Линтинг — через CI и команду pnpm lint. При желании позже можно добавить "\*.{ts,tsx,js,jsx}": ["eslint --fix"].

S-00.6.f — Smoke-тест 1. Создай файл с «плохим» форматированием, например packages/lib/src/tmp.ts. 2. git add packages/lib/src/tmp.ts 3. git commit -m "feat: hook formatting test" 4. Убедись, что коммит прошёл, а дифф отформатирован (одинаковые кавычки, точки с запятой/их отсутствие по .prettierrc, переносы строк и т. п.).

S-00.6.g — Документация

Создай /docs/notes/commit-hooks.md:

# Commit Hooks

- Husky pre-commit запускает `lint-staged`.
- lint-staged форматирует **только staged** файлы через Prettier.
- Конфиг в root `package.json` → `"lint-staged": { … }`.
- Обойти hook: `git commit --no-verify` (не рекомендуется).

⸻

Примечания
• Убедись, что Prettier уже установлен и настроен (см. S-00.2).
• Скрипт prepare в корне гарантирует установку husky-хуков после pnpm i.
• Если работаешь на Windows + Git GUI, проверь, что hooks исполняются (настройка Git по умолчанию ок).
