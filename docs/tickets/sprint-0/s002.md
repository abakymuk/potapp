S-00.2 — Lint/Format/TS Baseline

Goal: eslint + prettier + строгий tsconfig + импорт-алиасы @/.
Scope:
• In: единая конфигурация ESLint (flat), Prettier, базовые правила, alias @/ в apps/\*, скрипты lint/typecheck, обновление turbo.json, ignore-файлы.
• Out: husky/commit hooks, CI (переносим в S-00.3+).

AC (Gherkin)
• Given чистая монорепа
When выполняю pnpm lint
Then линт проходит без ошибок и с ненулевым количеством проверенных файлов.
• Given чистая монорепа
When выполняю pnpm typecheck
Then тип-чек завершается успешно (exit code 0) для всех пакетов и аппок.

DoD
• Установлены eslint (flat), prettier, плагины для TS и import
• Добавлены: eslint.config.js, .prettierrc, .eslintignore, .prettierignore
• Обновлён turbo.json: пайплайны lint и typecheck
• В apps/web и apps/worker настроены alias @/\*
• Везде есть скрипты lint и typecheck
• pnpm lint и pnpm typecheck зелёные
• Короткая заметка в /docs/notes/linting.md

⸻

Микротикеты (атомарные шаги)

S-00.2.a — Установка зависимостей

pnpm add -D eslint@^9 @eslint/js typescript@^5 \
 typescript-eslint@^7 eslint-plugin-import@^2 eslint-import-resolver-typescript@^3 \
 prettier@^3 eslint-config-prettier@^9

Пояснение:
• Используем ESLint flat config (v9), пакет typescript-eslint (мета-пак) и eslint-plugin-import + резолвер TS для корректной работы алиасов.
• eslint-config-prettier выключает конфликтующие правила.

⸻

S-00.2.b — Корневой ESLint (flat) конфиг

eslint.config.js (в корне):

// eslint.config.js
import js from '@eslint/js'
import tseslint from 'typescript-eslint'
import importPlugin from 'eslint-plugin-import'
import prettier from 'eslint-config-prettier'

export default tseslint.config(
js.configs.recommended,
...tseslint.configs.recommended, // базовые TS-правила без type-aware
{
name: 'base',
files: ['**/*.ts', '**/*.tsx', '**/*.js'],
ignores: [
'**/node_modules/**',
'**/dist/**',
'**/.next/**',
'**/build/**',
'**/.vercel/**',
'**/.turbo/**'
],
languageOptions: {
ecmaVersion: 'latest',
sourceType: 'module'
},
plugins: {
import: importPlugin
},
settings: {
'import/resolver': {
// поддержка ts-paths в монорепо
typescript: {
alwaysTryTypes: true,
project: [
'./tsconfig.base.json',
'./apps/*/tsconfig.json',
'./packages/*/tsconfig.json'
]
}
}
},
rules: {
// импорт-гигиена
'import/order': [
'error',
{
'newlines-between': 'always',
groups: [['builtin', 'external'], ['internal'], ['parent', 'sibling', 'index']],
alphabetize: { order: 'asc', caseInsensitive: true }
}
],
'import/no-unresolved': 'error',
// базовая строгость
'no-unused-vars': 'off',
'@typescript-eslint/no-unused-vars': ['warn', { argsIgnorePattern: '^_', varsIgnorePattern: '^_' }],
'@typescript-eslint/consistent-type-imports': ['warn', { prefer: 'type-imports' }],
// стиль делегируем Prettier
}
},
// всегда последним — отключает конфликты с Prettier
prettier
)

.eslintignore (в корне):

node_modules
dist
.next
build
.vercel
.turbo

⸻

S-00.2.c — Prettier конфиг и игнор

.prettierrc:

{
"printWidth": 100,
"singleQuote": true,
"semi": false,
"trailingComma": "all",
"arrowParens": "always",
"tabWidth": 2
}

.prettierignore:

node_modules
dist
.next
build
.vercel
.turbo
\*.lock

⸻

S-00.2.d — Строгий TypeScript и alias @/

Корневой tsconfig.base.json (добавить/уточнить строгие опции):

{
"compilerOptions": {
"target": "ES2022",
"lib": ["ES2022"],
"module": "ESNext",
"moduleResolution": "Bundler",
"declaration": true,
"declarationMap": true,
"sourceMap": true,
"outDir": "dist",
"rootDir": ".",
"strict": true,
"noUncheckedIndexedAccess": true,
"noImplicitOverride": true,
"noPropertyAccessFromIndexSignature": true,
"exactOptionalPropertyTypes": true,
"skipLibCheck": true,
"esModuleInterop": true,
"resolveJsonModule": true,
"forceConsistentCasingInFileNames": true,
"paths": {
"@contracts/_": ["packages/contracts/src/_"],
"@db/_": ["packages/db/src/_"],
"@lib/_": ["packages/lib/src/_"],
"@ui/_": ["packages/ui/src/_"]
}
}
}

Per-app alias @/\* (локально в приложениях):

apps/web/tsconfig.json

{
"extends": "../../tsconfig.base.json",
"compilerOptions": { "baseUrl": ".", "rootDir": "src", "outDir": "dist", "paths": { "@/_": ["src/_"] } },
"include": ["src"]
}

apps/worker/tsconfig.json

{
"extends": "../../tsconfig.base.json",
"compilerOptions": { "baseUrl": ".", "rootDir": "src", "outDir": "dist", "paths": { "@/_": ["src/_"] } },
"include": ["src"]
}

(в src каждого — сделать 1 импорт @/... для smoke-проверки, напр. import { helloLib } from '@/lib/index' уже есть; добавь что-то из @/utils)

⸻

S-00.2.e — Скрипты в root и пакетах

Root package.json добавь:

{
"scripts": {
"lint": "eslint .",
"format": "prettier -w .",
"format:check": "prettier -c .",
"typecheck": "turbo run typecheck"
}
}

Во всех apps/_ и packages/_/package.json добавь:

{
"scripts": {
"typecheck": "tsc -p tsconfig.json --noEmit",
"lint": "eslint ."
}
}

⸻

S-00.2.f — Обновить turbo.json

Добавь пайплайны lint и typecheck:

{
"$schema": "https://turbo.build/schema.json",
"pipeline": {
"build": { "dependsOn": ["^build"], "outputs": ["dist/**"] },
"typecheck": { "dependsOn": ["^typecheck"] },
"lint": { "dependsOn": ["^lint"] },
"dev": { "cache": false },
"clean": {}
}
}

⸻

S-00.2.g — Smoke-ран и документация

pnpm i
pnpm lint
pnpm typecheck

Ожидаемо: обе команды зелёные.

/docs/notes/linting.md (кратко):

# Linting & Formatting

- ESLint (flat config, eslint@9) + typescript-eslint
- import/order + TS правила
- Prettier как единый форматтер
- Алиасы: @/\* внутри apps, @lib/@db/@ui/@contracts из packages
- Команды: `pnpm lint`, `pnpm typecheck`, `pnpm format`

⸻

Примечания
• Type-aware ESLint (с parserOptions.project) включим позже точечно для доменных пакетов/аппок, чтобы не замедлять DX на старте.
• Коммит-хуки Husky/lint-staged и CI-проверки — в S-00.3.
• Для IDE: рекомендуй включить Format on Save и ESLint интеграцию (VS Code: dbaeumer.vscode-eslint, esbenp.prettier-vscode).
