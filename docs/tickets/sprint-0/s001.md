S-00.1 — Setup Monorepo

Goal: pnpm + turborepo, структура apps/{web,worker}, packages/{contracts,db,lib,ui}.
Scope:
• In: базовая файловая структура, pnpm-workspaces, turbo, TypeScript base config, минимальные билды для всех пакетов и аппок.
• Out: Next.js/Hono реальная логика, ESLint/Prettier/CI (это в S-00.2+).

AC (Gherkin)
• Given новый репозиторий
When я выполняю pnpm i
Then все зависимости устанавливаются без ошибок.
• Given инициализированная монорепа
When я выполняю pnpm build
Then все пакеты и приложения собираются (создаются dist/\*\*), команда завершается с кодом 0.

DoD
• Структура каталогов создана
• pnpm-workspace.yaml, package.json, turbo.json, tsconfig.base.json добавлены
• Каждый пакет/аппа имеет build/clean скрипты и проходит сборку
• pnpm i и pnpm build успешно завершаются локально
• Короткая заметка в /docs/notes/monorepo.md

⸻

Микротикеты (атомарные шаги)

S-00.1.a — Инициализация корня и менеджеров 1. Создай корень репо и файлы:

mkdir -p apps/{web,worker} packages/{contracts,db,lib,ui} docs/notes
git init
pnpm init -y
pnpm add -D turbo typescript

    2.	package.json (root):

{
"name": "potlucky",
"private": true,
"packageManager": "pnpm@9.6.0",
"engines": { "node": ">=20.10.0" },
"scripts": {
"build": "turbo run build",
"clean": "turbo run clean",
"dev": "turbo run dev"
},
"devDependencies": {
"turbo": "^2.0.6",
"typescript": "^5.5.4"
}
}

    3.	pnpm-workspace.yaml:

packages:

- "apps/\*"
- "packages/\*" 4. .gitignore:

node_modules
dist
.build
.tmp
.vscode
.DS_Store

⸻

S-00.1.b — turborepo pipeline

turbo.json в корне:

{
"$schema": "https://turbo.build/schema.json",
"pipeline": {
"build": {
"dependsOn": ["^build"],
"outputs": ["dist/**"]
},
"dev": { "cache": false },
"clean": {}
}
}

⸻

S-00.1.c — Общий TypeScript конфиг

tsconfig.base.json в корне:

{
"compilerOptions": {
"target": "ES2022",
"lib": ["ES2022"],
"module": "ESNext",
"moduleResolution": "Bundler",
"declaration": true,
"declarationMap": true,
"sourceMap": true,
"outDir": "dist",
"rootDir": ".",
"strict": true,
"noUncheckedIndexedAccess": true,
"skipLibCheck": true,
"esModuleInterop": true,
"resolveJsonModule": true,
"forceConsistentCasingInFileNames": true,
"paths": {
"@contracts/_": ["packages/contracts/src/_"],
"@db/_": ["packages/db/src/_"],
"@lib/_": ["packages/lib/src/_"],
"@ui/_": ["packages/ui/src/_"]
}
}
}

⸻

S-00.1.d — Бойлерплейт для packages/

Сгенерируй для каждого пакета (ниже пример для contracts; повтори для db, lib, ui):

packages/contracts/package.json

{
"name": "@potlucky/contracts",
"version": "0.0.0",
"type": "module",
"main": "dist/index.js",
"types": "dist/index.d.ts",
"scripts": {
"build": "tsc -p tsconfig.json",
"clean": "rimraf dist || true",
"dev": "tsc -w -p tsconfig.json"
},
"devDependencies": {
"typescript": "^5.5.4",
"rimraf": "^6.0.1"
}
}

packages/contracts/tsconfig.json

{
"extends": "../../tsconfig.base.json",
"compilerOptions": { "rootDir": "src", "outDir": "dist" },
"include": ["src"]
}

packages/contracts/src/index.ts

export type CloudEvent<T = unknown> = {
id: string;
source: string;
type: string;
subject?: string;
time: string; // ISO
data: T;
};

export const helloContracts = () => "contracts-ready";

Повтори то же для:
• packages/db/src/index.ts:

export const helloDb = () => "db-ready";

    •	packages/lib/src/index.ts:

import { helloContracts } from "@contracts/index";
export const helloLib = () => `lib-ready with ${helloContracts()}`;

    •	packages/ui/src/index.ts:

export const helloUi = () => "ui-ready";

(в package.json каждого — одинаковые скрипты build/clean/dev, имя: @potlucky/<pkg>)

⸻

S-00.1.e — Минимальные apps/

Пока без Next/Hono — просто TS-проекты, которые импортируют пакеты и успешно билдятся.

apps/web/package.json

{
"name": "@app/web",
"version": "0.0.0",
"type": "module",
"main": "dist/index.js",
"types": "dist/index.d.ts",
"scripts": {
"build": "tsc -p tsconfig.json",
"clean": "rimraf dist || true",
"dev": "tsc -w -p tsconfig.json"
},
"dependencies": {
"@potlucky/lib": "workspace:\*"
},
"devDependencies": {
"typescript": "^5.5.4",
"rimraf": "^6.0.1"
}
}

apps/web/tsconfig.json

{
"extends": "../../tsconfig.base.json",
"compilerOptions": { "rootDir": "src", "outDir": "dist" },
"include": ["src"]
}

apps/web/src/index.ts

import { helloLib } from "@lib/index";
export const webBoot = () => `web-ready with ${helloLib()}`;

apps/worker/package.json

{
"name": "@app/worker",
"version": "0.0.0",
"type": "module",
"main": "dist/index.js",
"types": "dist/index.d.ts",
"scripts": {
"build": "tsc -p tsconfig.json",
"clean": "rimraf dist || true",
"dev": "tsc -w -p tsconfig.json"
},
"dependencies": {
"@potlucky/contracts": "workspace:_",
"@potlucky/lib": "workspace:_"
},
"devDependencies": {
"typescript": "^5.5.4",
"rimraf": "^6.0.1"
}
}

apps/worker/tsconfig.json

{
"extends": "../../tsconfig.base.json",
"compilerOptions": { "rootDir": "src", "outDir": "dist" },
"include": ["src"]
}

apps/worker/src/index.ts

import type { CloudEvent } from "@contracts/index";
export const consume = (e: CloudEvent) => `worker-ready for ${e.type}`;

⸻

S-00.1.f — Smoke-test и документация 1. Установка и сборка:

pnpm i
pnpm build

Ожидаемо: у каждого пакета/аппы появляется dist/\*\*, команда завершается без ошибок. 2. Создай /docs/notes/monorepo.md с кратким описанием:

# Monorepo

- pnpm workspaces + turborepo
- apps: web, worker
- packages: contracts, db, lib, ui
- команды: `pnpm build|clean|dev`

⸻

Примечания и зависимости от следующих тикетов
• Настройка ESLint/Prettier, CODEOWNERS и CI — S-00.2+.
• Реальное Next.js и Hono/Workers появятся в S-02 и S-03 соответственно (этот тикет лишь гарантирует, что билды проходят).
• Алиасы @contracts/_, @db/_, @lib/_, @ui/_ уже готовы в tsconfig.base.json и демонстрируются в импортах.
